# 온보딩 플로우 개선사항

## 📋 개선 항목 요약

1. **무료 배경 이미지 카테고리 명확화** (Unsplash API)
2. **AI 프롬프트 편집 기능 추가** (Flow 4-6)
3. **프롬프트 남용 방지 시스템**
4. **신규 기능 잠금 해제 개선** (실용성 중심)
5. **결과 페이지 가입 유도 강화** (Sticky CTA)

---

## 1. Unsplash API 배경 이미지 카테고리

### 카테고리 매핑 전략

```javascript
// 배경 스타일별 Unsplash 검색 설정
const backgroundStyles = {
  // ===== MVP 기본 스타일 (5종) =====

  clean_white: {
    name: "깔끔한 흰색",
    description: "미니멀하고 깔끔한 흰색 배경",
    unsplashQuery: "white+background+minimal+product",
    collections: [1163637], // Minimal collection
    orientation: "landscape",
    color: "white",
    적합상품: ["전자제품", "화장품", "의류"]
  },

  luxury_marble: {
    name: "고급 대리석",
    description: "프리미엄 느낌의 대리석 질감",
    unsplashQuery: "marble+texture+luxury+background",
    collections: [1580860], // Textures & Patterns
    orientation: "landscape",
    color: "white,black",
    적합상품: ["시계", "주얼리", "명품"]
  },

  natural_light: {
    name: "자연광 느낌",
    description: "부드러운 자연광 배경",
    unsplashQuery: "natural+light+soft+background",
    collections: [3330445], // Nature
    orientation: "landscape",
    color: "white,yellow",
    적합상품: ["생활용품", "식품", "식물"]
  },

  pastel_gradient: {
    name: "파스텔 그라데이션",
    description: "감성적인 파스텔톤 그라데이션",
    unsplashQuery: "pastel+gradient+soft+background",
    collections: [894], // Color
    orientation: "landscape",
    color: "yellow,pink,teal",
    적합상품: ["패션", "문구", "디저트"]
  },

  studio_shadow: {
    name: "스튜디오 그림자",
    description: "전문가 수준 스튜디오 그림자 효과",
    unsplashQuery: "studio+shadow+product+background",
    collections: [1163637],
    orientation: "landscape",
    color: "white,gray",
    적합상품: ["운동화", "가전", "가구"]
  },

  // ===== Phase 2 추가 스타일 =====

  neon_glow: {
    name: "네온 빛 배경",
    description: "트렌디한 네온 조명 효과",
    unsplashQuery: "neon+lights+dark+background",
    collections: [8892482], // Urban
    orientation: "landscape",
    color: "black,blue,purple",
    적합상품: ["전자제품", "게이밍 기어", "음향기기"],
    unlockCondition: { imageGenerated: 5 }
  },

  vintage_feel: {
    name: "빈티지 느낌",
    description: "따뜻한 레트로 감성",
    unsplashQuery: "vintage+retro+background+texture",
    collections: [219941], // Vintage
    orientation: "landscape",
    color: "yellow,brown",
    적합상품: ["카메라", "레코드", "앤티크"],
    unlockCondition: { imageGenerated: 10 }
  },

  wooden_table: {
    name: "원목 테이블",
    description: "내추럴한 원목 질감",
    unsplashQuery: "wood+table+texture+background",
    collections: [1163637],
    orientation: "landscape",
    color: "brown",
    적합상품: ["식품", "공예품", "문구"],
    unlockCondition: { imageGenerated: 15 }
  },

  bokeh_blur: {
    name: "보케 블러",
    description: "아웃포커스 보케 효과",
    unsplashQuery: "bokeh+blur+background+lights",
    collections: [894],
    orientation: "landscape",
    color: "all",
    적합상품: ["주얼리", "향수", "소품"],
    unlockCondition: { imageGenerated: 20 }
  }
};
```

### Unsplash API 제한 및 해결책

```yaml
API 제한사항:
  무료 플랜:
    - 요청: 50 requests/hour
    - 다운로드: 50 downloads/hour
    - 월간: 50,000 requests

해결 전략:
  1. 로컬 캐싱 (Redis):
    - TTL: 1시간
    - 스타일별 5개 후보 캐싱

  2. Supabase Storage 영구 저장:
    - 인기 배경 100개 사전 다운로드
    - CDN 배포로 빠른 로딩

  3. 로테이션 전략:
    - 같은 스타일도 매번 다른 이미지
    - 5개 후보 중 랜덤 선택

  4. Attribution 준수:
    - 다운로드 시 Unsplash 작가 크레딧 표시
    - Download tracking API 호출
```

### Backend 구현

```python
from functools import lru_cache
import hashlib
import random

class BackgroundImageService:
    def __init__(self):
        self.cache_ttl = 3600  # 1시간
        self.local_pool_size = 100  # 로컬 저장소에 100개 저장

    @lru_cache(maxsize=50)
    async def get_background(self, style: str, seed: int = None) -> dict:
        """
        배경 이미지 조회 (캐싱 적용)

        Args:
            style: 배경 스타일 키 (e.g., "luxury_marble")
            seed: 랜덤 시드 (같은 시드 = 같은 이미지)
        """
        # 1. Redis 캐시 확인
        cache_key = f"bg:{style}:{seed or 'random'}"
        cached = await redis.get(cache_key)
        if cached:
            return json.loads(cached)

        # 2. Supabase 로컬 저장소 확인
        local_images = await self.get_local_pool(style)
        if local_images:
            selected = random.choice(local_images) if not seed else local_images[seed % len(local_images)]
            await redis.setex(cache_key, self.cache_ttl, json.dumps(selected))
            return selected

        # 3. Unsplash API 호출 (캐시 미스)
        fresh = await self.fetch_from_unsplash(style)

        # 4. 로컬 저장소에 추가
        await self.save_to_local_pool(style, fresh)

        # 5. Redis 캐싱
        await redis.setex(cache_key, self.cache_ttl, json.dumps(fresh))

        return fresh

    async def fetch_from_unsplash(self, style: str) -> dict:
        """Unsplash API에서 새 이미지 조회"""
        config = backgroundStyles[style]

        params = {
            "query": config["unsplashQuery"],
            "orientation": config["orientation"],
            "color": config["color"],
            "per_page": 5,
            "client_id": settings.UNSPLASH_ACCESS_KEY
        }

        response = await httpx.get(
            "https://api.unsplash.com/search/photos",
            params=params
        )
        data = response.json()

        # 랜덤 선택
        images = data["results"]
        selected = random.choice(images[:5])

        # Download tracking (Unsplash 요구사항)
        await httpx.get(selected["links"]["download_location"])

        return {
            "url": selected["urls"]["regular"],  # 1080px
            "download_url": selected["urls"]["full"],
            "thumb_url": selected["urls"]["thumb"],
            "photographer": selected["user"]["name"],
            "photographer_url": selected["user"]["links"]["html"],
            "source": "unsplash",
            "style": style
        }

    async def get_local_pool(self, style: str) -> list:
        """Supabase 로컬 저장소에서 이미지 목록 조회"""
        path = f"backgrounds/{style}/pool.json"
        try:
            data = await supabase.storage.from_("images").download(path)
            return json.loads(data)
        except:
            return []

    async def save_to_local_pool(self, style: str, image: dict):
        """로컬 저장소에 이미지 추가 (최대 100개 유지)"""
        pool = await self.get_local_pool(style)
        pool.append(image)

        # 100개 초과 시 오래된 것부터 제거
        if len(pool) > self.local_pool_size:
            pool = pool[-self.local_pool_size:]

        path = f"backgrounds/{style}/pool.json"
        await supabase.storage.from_("images").upload(
            path,
            json.dumps(pool).encode(),
            {"upsert": True}
        )


# API 엔드포인트
@router.get("/backgrounds/{style}")
async def get_background_image(
    style: str,
    seed: int = None
):
    """
    배경 이미지 조회

    Query Params:
        - seed: 같은 시드 = 같은 이미지 (재현성)
    """
    service = BackgroundImageService()

    if style not in backgroundStyles:
        raise HTTPException(404, f"배경 스타일 '{style}'를 찾을 수 없어요")

    image = await service.get_background(style, seed)

    return {
        "style": style,
        "image": image,
        "attribution": {
            "text": f"Photo by {image['photographer']} on Unsplash",
            "url": image["photographer_url"]
        }
    }
```

---

## 2. AI 프롬프트 편집 기능

### 기능 개요

사용자가 자연어로 이미지 수정 요청을 하면 AI가 자동으로 조정합니다.

```yaml
기능:
  - 배경 밝기/대비 조절
  - 상품 위치 이동 (좌/우/중앙)
  - 그림자 강도 조절
  - 보케/블러 효과 추가
  - 색감 조정 (따뜻하게/차갑게)

제한사항:
  - 프롬프트 길이: 100자 이내
  - 일일 사용량: 10회
  - 시간당: 3회
  - 크레딧: 1회당 1 크레딧

기술 구현:
  - MVP: Pillow 기본 이미지 조작
  - Phase 2: OpenAI DALL-E Variations
  - Phase 3: Stable Diffusion Img2Img + ControlNet
```

### UI 플로우

```
[사용자 클릭: "AI 프롬프트 편집"]
         ↓
┌─────────────────────────────────────┐
│  🎨 AI 프롬프트로 이미지 세밀 조정   │
│                                     │
│  원하는 수정 사항을 설명해주세요!    │
│                                     │
│  ┌───────────────────────────────┐  │
│  │ 배경을 더 밝게, 상품은 왼쪽으로│  │
│  │                               │  │
│  └───────────────────────────────┘  │
│                                     │
│  📝 예시 프롬프트:                  │
│  • "배경을 더 어둡게 해주세요"      │
│  • "상품을 중앙에 배치해주세요"     │
│  • "그림자를 더 진하게"            │
│                                     │
│  ⚠️ 사용량: 8/10 남음 (오늘)        │
│  💰 크레딧: 1 차감                  │
│                                     │
│  [생성하기 (-1 크레딧)]   [취소]    │
└─────────────────────────────────────┘
         ↓
[AI 처리 중... 15초]
         ↓
┌─────────────────────────────────────┐
│  ✅ 수정 완료!                       │
│                                     │
│  Before          After              │
│  [원본]          [수정본]            │
│                                     │
│  프롬프트: "배경을 더 밝게..."       │
│                                     │
│  [다운로드]  [다시 수정]  [취소]    │
└─────────────────────────────────────┘
```

### 프롬프트 남용 방지 시스템

```python
class PromptModerationService:
    """프롬프트 검증 및 남용 방지"""

    # 금지 키워드 (NSFW, 폭력, 유명인 등)
    BANNED_KEYWORDS = [
        # 성인 콘텐츠
        "nude", "naked", "nsfw", "porn", "sex",
        # 폭력
        "blood", "gore", "violent", "weapon", "gun", "knife",
        # 유명인/정치인
        "celebrity", "politician", "trump", "biden", "bts",
        # 딥페이크
        "deepfake", "face swap",
        # 불법
        "drug", "cocaine", "marijuana"
    ]

    # 의심 패턴 (정규식)
    SUSPICIOUS_PATTERNS = [
        r"remove\s+(clothing|clothes)",  # "옷 제거"
        r"add\s+(nude|naked)",  # "누드 추가"
        r"make\s+.*(sexy|hot|provocative)",  # "섹시하게"
    ]

    async def validate_prompt(
        self,
        user_id: int,
        prompt: str
    ) -> dict:
        """
        프롬프트 검증

        Returns:
            {
                "allowed": bool,
                "reason": str (차단 시),
                "daily_remaining": int,
                "hourly_remaining": int
            }
        """
        # 1. 길이 검증
        if len(prompt) > 100:
            return {
                "allowed": False,
                "reason": "프롬프트는 100자 이내로 입력해주세요"
            }

        # 2. 빈 프롬프트
        if not prompt.strip():
            return {
                "allowed": False,
                "reason": "수정 사항을 입력해주세요"
            }

        # 3. 금지 키워드 검사
        prompt_lower = prompt.lower()
        for keyword in self.BANNED_KEYWORDS:
            if keyword in prompt_lower:
                await self.log_violation(user_id, "banned_keyword", keyword)
                return {
                    "allowed": False,
                    "reason": f"부적절한 단어가 포함되어 있어요"
                }

        # 4. 의심 패턴 검사
        import re
        for pattern in self.SUSPICIOUS_PATTERNS:
            if re.search(pattern, prompt_lower):
                await self.log_violation(user_id, "suspicious_pattern", pattern)
                return {
                    "allowed": False,
                    "reason": "부적절한 요청이 감지되었어요"
                }

        # 5. OpenAI Moderation API (추가 검증)
        try:
            moderation = await openai.Moderation.create(input=prompt)
            if moderation.results[0].flagged:
                categories = moderation.results[0].categories
                flagged = [k for k, v in categories.items() if v]
                await self.log_violation(user_id, "openai_moderation", flagged)
                return {
                    "allowed": False,
                    "reason": "부적절한 내용이 감지되었어요"
                }
        except Exception as e:
            # Moderation API 오류 시에도 진행 (과도한 차단 방지)
            logger.warning(f"Moderation API error: {e}")

        # 6. Rate Limiting 검사
        today = datetime.now().date()
        hour = datetime.now().hour

        daily_key = f"prompt_daily:{user_id}:{today}"
        hourly_key = f"prompt_hourly:{user_id}:{today}:{hour}"

        daily_count = await redis.get(daily_key) or 0
        hourly_count = await redis.get(hourly_key) or 0

        if int(daily_count) >= 10:
            return {
                "allowed": False,
                "reason": "오늘의 프롬프트 사용 한도를 초과했어요 (10회)",
                "daily_remaining": 0
            }

        if int(hourly_count) >= 3:
            return {
                "allowed": False,
                "reason": "잠시 후 다시 시도해주세요 (시간당 3회 제한)",
                "hourly_remaining": 0
            }

        # 7. 사용량 증가
        await redis.incr(daily_key)
        await redis.expire(daily_key, 86400)  # 24시간
        await redis.incr(hourly_key)
        await redis.expire(hourly_key, 3600)  # 1시간

        return {
            "allowed": True,
            "daily_remaining": 10 - int(daily_count) - 1,
            "hourly_remaining": 3 - int(hourly_count) - 1
        }

    async def log_violation(
        self,
        user_id: int,
        violation_type: str,
        details: any
    ):
        """위반 로그 기록 (모니터링용)"""
        await db.execute(
            """
            INSERT INTO prompt_violations (user_id, violation_type, details, created_at)
            VALUES (:user_id, :violation_type, :details, NOW())
            """,
            {
                "user_id": user_id,
                "violation_type": violation_type,
                "details": json.dumps(details)
            }
        )

        # 3회 위반 시 계정 플래그
        violation_count = await db.fetchval(
            "SELECT COUNT(*) FROM prompt_violations WHERE user_id = :user_id AND created_at > NOW() - INTERVAL '7 days'",
            {"user_id": user_id}
        )

        if violation_count >= 3:
            await self.flag_user(user_id, "repeated_violations")
```

### MVP 구현 (Pillow 기반)

```python
class SimplePromptEditor:
    """MVP: Pillow 기반 간단한 프롬프트 편집"""

    def __init__(self):
        self.supported_commands = {
            "밝게": self.adjust_brightness,
            "어둡게": self.adjust_brightness,
            "왼쪽": self.move_subject,
            "오른쪽": self.move_subject,
            "중앙": self.move_subject,
            "그림자": self.adjust_shadow
        }

    async def apply_prompt(self, image_path: str, prompt: str) -> str:
        """
        프롬프트를 파싱하고 이미지 조작 적용

        Args:
            image_path: 원본 이미지 경로
            prompt: 사용자 프롬프트 (e.g., "배경을 더 밝게")

        Returns:
            edited_image_path: 수정된 이미지 경로
        """
        from PIL import Image, ImageEnhance, ImageFilter

        img = Image.open(image_path)

        # 프롬프트 파싱
        prompt_lower = prompt.lower()

        # 밝기 조절
        if "밝게" in prompt_lower or "bright" in prompt_lower:
            enhancer = ImageEnhance.Brightness(img)
            img = enhancer.enhance(1.3)  # 30% 증가
        elif "어둡게" in prompt_lower or "dark" in prompt_lower:
            enhancer = ImageEnhance.Brightness(img)
            img = enhancer.enhance(0.7)  # 30% 감소

        # 대비 조절
        if "대비" in prompt_lower or "contrast" in prompt_lower:
            enhancer = ImageEnhance.Contrast(img)
            img = enhancer.enhance(1.2)

        # 채도 조절
        if "선명" in prompt_lower or "vivid" in prompt_lower:
            enhancer = ImageEnhance.Color(img)
            img = enhancer.enhance(1.2)

        # 블러 효과
        if "흐리게" in prompt_lower or "blur" in prompt_lower or "보케" in prompt_lower:
            img = img.filter(ImageFilter.GaussianBlur(radius=3))

        # 저장
        output_path = f"/tmp/edited_{uuid.uuid4()}.png"
        img.save(output_path, quality=95)

        return output_path
```

---

## 3. 신규 기능 잠금 해제 개선

### 실용성 중심 기능

```javascript
// 개선된 기능 잠금 해제 (일반 사용자 친화적)
const practicalFeatureUnlocks = [
  // ===== Level 1: 초보자 (3개 생성) =====
  {
    level: 1,
    trigger: { imageGenerated: 3 },
    feature: "batch_download",
    icon: "📦",
    title: "일괄 다운로드",
    description: "프로젝트의 모든 이미지를 ZIP 파일로 한 번에 다운로드",
    benefit: "시간 절약: 10초 → 1초",
    cta: "사용해보기",
    value: "high",
    implementation: "간단 (ZIP 압축)"
  },

  // ===== Level 2: 활성 사용자 (5개 생성) =====
  {
    level: 2,
    trigger: { imageGenerated: 5 },
    feature: "platform_presets",
    icon: "📐",
    title: "플랫폼별 맞춤 크기",
    description: "네이버 쇼핑, 쿠팡, 인스타 등 플랫폼별 최적 크기 자동 다운로드",
    benefit: "수동 크롭 불필요",
    presets: [
      { platform: "네이버 쇼핑", size: "700x700", format: "JPG" },
      { platform: "쿠팡", size: "800x800", format: "JPG" },
      { platform: "11번가", size: "1000x1000", format: "JPG" },
      { platform: "인스타그램 피드", size: "1080x1080", format: "JPG" },
      { platform: "인스타 스토리", size: "1080x1920", format: "PNG" },
      { platform: "페이스북", size: "1200x630", format: "JPG" }
    ],
    cta: "플랫폼 선택하기",
    value: "high",
    implementation: "중간 (resize + 포맷 변환)"
  },

  // ===== Level 3: 파워 유저 (10개 생성) =====
  {
    level: 3,
    trigger: { imageGenerated: 10 },
    feature: "saved_styles",
    icon: "⭐",
    title: "배경 스타일 저장",
    description: "자주 쓰는 배경 스타일을 즐겨찾기에 저장하고 빠르게 재사용",
    benefit: "재선택 시간 절약",
    maxSaved: 5,
    cta: "즐겨찾기 관리",
    value: "medium",
    implementation: "간단 (DB에 user_favorites 테이블)"
  },

  // ===== Level 4: 프로 유저 (20개 생성) =====
  {
    level: 4,
    trigger: { imageGenerated: 20 },
    feature: "bulk_regenerate",
    icon: "⚡",
    title: "일괄 재생성",
    description: "여러 이미지의 배경/문구를 한 번에 변경",
    benefit: "10개 이미지를 1분 만에 재생성",
    cta: "일괄 편집하기",
    value: "high",
    implementation: "복잡 (비동기 작업 큐)"
  },

  // ===== Level 5: 마스터 (50개 생성) =====
  {
    level: 5,
    trigger: { imageGenerated: 50 },
    feature: "history_search",
    icon: "🔍",
    title: "이미지 히스토리 검색",
    description: "과거 생성한 이미지를 키워드로 빠르게 검색",
    benefit: "찾기 쉬움: 스크롤 → 검색",
    cta: "검색해보기",
    value: "medium",
    implementation: "중간 (Elasticsearch 또는 PostgreSQL Full-Text Search)"
  },

  // ===== 특별 조건: 리퍼럴 =====
  {
    level: "special",
    trigger: { friendsInvited: 3 },
    feature: "priority_processing",
    icon: "🚀",
    title: "우선 처리권",
    description: "이미지 생성 시 대기열 없이 즉시 처리 (7일간)",
    benefit: "대기 시간 0초",
    duration: "7일",
    cta: "활성화하기",
    value: "high",
    implementation: "중간 (Redis 큐 우선순위)"
  }
];
```

### 잠금 해제 알림 UI

```tsx
// 기능 잠금 해제 알림 컴포넌트
function FeatureUnlockNotification({ feature }) {
  return (
    <motion.div
      initial={{ opacity: 0, y: 50 }}
      animate={{ opacity: 1, y: 0 }}
      className="fixed bottom-4 right-4 z-50"
    >
      <div className="bg-gradient-to-br from-purple-600 to-pink-600 text-white rounded-2xl p-6 shadow-2xl max-w-md">
        {/* 축하 애니메이션 */}
        <Lottie
          animation="celebration"
          className="w-16 h-16 mb-4"
        />

        <div className="space-y-3">
          {/* 아이콘 + 제목 */}
          <div className="flex items-center gap-3">
            <div className="text-4xl">{feature.icon}</div>
            <div>
              <div className="text-sm opacity-80">새 기능 잠금 해제!</div>
              <div className="text-xl font-bold">{feature.title}</div>
            </div>
          </div>

          {/* 설명 */}
          <p className="text-sm opacity-90">
            {feature.description}
          </p>

          {/* 혜택 강조 */}
          <div className="bg-white/20 rounded-lg p-3">
            <div className="text-xs opacity-80">혜택</div>
            <div className="font-semibold">{feature.benefit}</div>
          </div>

          {/* CTA */}
          <div className="flex gap-2">
            <button className="flex-1 bg-white text-purple-600 font-bold py-2 px-4 rounded-lg hover:bg-gray-100 transition">
              {feature.cta}
            </button>
            <button className="px-4 py-2 rounded-lg border border-white/30 hover:bg-white/10 transition">
              나중에
            </button>
          </div>
        </div>
      </div>
    </motion.div>
  );
}
```

---

## 4. 결과 페이지 가입 유도 강화

### Sticky CTA 버튼 (우측 고정)

```tsx
// 우측에 고정된 가입 유도 CTA
function StickySignupCTA({ show = true }) {
  if (!show) return null;

  return (
    <div className="fixed right-4 top-1/2 -translate-y-1/2 z-50 animate-fadeIn">
      <motion.div
        initial={{ x: 100, opacity: 0 }}
        animate={{ x: 0, opacity: 1 }}
        transition={{ delay: 2 }} // 2초 후 등장
        className="relative"
      >
        {/* 빛나는 펄스 효과 */}
        <div className="absolute -top-2 -right-2 w-6 h-6 bg-yellow-400 rounded-full animate-ping" />

        {/* 메인 카드 */}
        <div className="bg-gradient-to-br from-purple-600 via-purple-700 to-pink-600 text-white rounded-2xl p-6 shadow-2xl w-72 border-2 border-yellow-400">
          {/* 헤더 */}
          <div className="text-center mb-4">
            <div className="text-3xl mb-2">🎁</div>
            <div className="text-xl font-bold">지금 가입하면</div>
            <div className="text-sm opacity-80">2,143명이 사용 중!</div>
          </div>

          {/* 혜택 리스트 */}
          <div className="space-y-2 mb-4">
            <div className="flex items-center gap-2 text-sm">
              <div className="w-5 h-5 bg-white/20 rounded-full flex items-center justify-center text-xs">
                ✓
              </div>
              <span className="font-medium">워터마크 즉시 제거</span>
            </div>
            <div className="flex items-center gap-2 text-sm">
              <div className="w-5 h-5 bg-white/20 rounded-full flex items-center justify-center text-xs">
                ✓
              </div>
              <span className="font-medium">10 크레딧 무료 (9,900원)</span>
            </div>
            <div className="flex items-center gap-2 text-sm">
              <div className="w-5 h-5 bg-white/20 rounded-full flex items-center justify-center text-xs">
                ✓
              </div>
              <span className="font-medium">고해상도 다운로드 (4K)</span>
            </div>
            <div className="flex items-center gap-2 text-sm">
              <div className="w-5 h-5 bg-white/20 rounded-full flex items-center justify-center text-xs">
                ✓
              </div>
              <span className="font-medium">5가지 배경 스타일 무료</span>
            </div>
          </div>

          {/* CTA 버튼 */}
          <button className="w-full bg-white text-purple-600 font-bold py-3 px-4 rounded-lg hover:bg-yellow-50 transition-all transform hover:scale-105 shadow-lg">
            30초 만에 가입하기
          </button>

          {/* 부가 정보 */}
          <div className="text-xs text-center mt-3 opacity-80">
            신용카드 필요 없음 • 언제든 해지 가능
          </div>
        </div>

        {/* 화살표 힌트 (애니메이션) */}
        <div className="absolute -left-8 top-1/2 -translate-y-1/2">
          <motion.div
            animate={{ x: [0, -10, 0] }}
            transition={{ repeat: Infinity, duration: 1.5 }}
            className="text-4xl"
          >
            👈
          </motion.div>
        </div>
      </motion.div>
    </div>
  );
}
```

### 결과 페이지 전체 레이아웃 (개선)

```tsx
function TrialResultPage() {
  const [showStickyAny, setShowStickyCTA] = useState(false);

  useEffect(() => {
    // 3초 후 Sticky CTA 표시
    const timer = setTimeout(() => setShowStickyCTA(true), 3000);
    return () => clearTimeout(timer);
  }, []);

  return (
    <div className="relative min-h-screen bg-gray-50">
      {/* Sticky CTA (우측 고정) */}
      <StickySignupCTA show={showStickyCTA} />

      {/* 메인 콘텐츠 */}
      <div className="max-w-4xl mx-auto p-6">
        {/* 헤더 */}
        <div className="flex items-center justify-between mb-6">
          <button className="text-gray-600 hover:text-gray-900">
            ← 뒤로
          </button>
          <button className="text-purple-600 hover:text-purple-700">
            공유하기
          </button>
        </div>

        {/* 타이틀 */}
        <div className="text-center mb-8">
          <h1 className="text-3xl font-bold mb-2">
            완성된 이미지를 확인해보세요! 🎉
          </h1>
          <p className="text-gray-600">
            마음에 드시나요? 가입하고 워터마크 없이 다운로드하세요!
          </p>
        </div>

        {/* Before/After 비교 */}
        <div className="bg-white rounded-2xl shadow-xl p-8 mb-6">
          <BeforeAfterSlider
            before="/trial/before.jpg"
            after="/trial/after.jpg"
            watermark="PREVIEW - 가입하고 제거하기"
          />
        </div>

        {/* AI 생성 광고 문구 */}
        <div className="bg-white rounded-2xl shadow-lg p-6 mb-6">
          <div className="flex items-center gap-2 mb-4">
            <span className="text-2xl">✍️</span>
            <h3 className="text-lg font-bold">AI가 만든 광고 문구</h3>
          </div>

          <div className="bg-purple-50 rounded-lg p-4 mb-4">
            <p className="text-gray-800">
              "당신의 스타일을 완성하세요. 프리미엄 운동화로 매일을 특별하게."
            </p>
          </div>

          <div className="flex gap-2">
            <button className="px-4 py-2 bg-gray-100 rounded-lg text-sm hover:bg-gray-200">
              SNS용
            </button>
            <button className="px-4 py-2 bg-gray-100 rounded-lg text-sm hover:bg-gray-200">
              상세설명용
            </button>
            <button className="px-4 py-2 bg-gray-100 rounded-lg text-sm hover:bg-gray-200">
              스토리텔링용
            </button>
          </div>
        </div>

        {/* 메인 가입 CTA (페이지 내) */}
        <div className="bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-2xl p-8 mb-6 shadow-xl">
          <div className="text-center">
            <div className="text-2xl mb-3">🔥</div>
            <h3 className="text-2xl font-bold mb-2">
              지금 가입하면
            </h3>
            <p className="text-sm opacity-90 mb-6">
              2,143명이 사용 중!
            </p>

            <div className="grid grid-cols-2 gap-4 mb-6">
              <div className="bg-white/20 rounded-lg p-4">
                <div className="text-3xl mb-2">✅</div>
                <div className="font-semibold">워터마크 제거</div>
                <div className="text-xs opacity-80">이 이미지 즉시 다운로드</div>
              </div>
              <div className="bg-white/20 rounded-lg p-4">
                <div className="text-3xl mb-2">🎁</div>
                <div className="font-semibold">10 크레딧 무료</div>
                <div className="text-xs opacity-80">9,900원 상당</div>
              </div>
              <div className="bg-white/20 rounded-lg p-4">
                <div className="text-3xl mb-2">📥</div>
                <div className="font-semibold">고해상도 다운로드</div>
                <div className="text-xs opacity-80">4K 지원</div>
              </div>
              <div className="bg-white/20 rounded-lg p-4">
                <div className="text-3xl mb-2">🎨</div>
                <div className="font-semibold">5가지 배경 무료</div>
                <div className="text-xs opacity-80">프리미엄 스타일</div>
              </div>
            </div>

            <button className="w-full bg-white text-purple-600 font-bold py-4 px-6 rounded-lg hover:bg-yellow-50 transition-all transform hover:scale-105 shadow-lg text-lg">
              🎁 30초 만에 무료 가입하고 다운로드하기
            </button>

            <p className="text-xs mt-4 opacity-80">
              신용카드 필요 없음 • 언제든 해지 가능
            </p>
          </div>
        </div>

        {/* 다른 옵션 */}
        <div className="text-center">
          <p className="text-gray-600 mb-4">또는 더 체험해보기</p>
          <button className="text-purple-600 hover:text-purple-700 font-semibold">
            다른 스타일로 다시 생성하기 →
          </button>
          <p className="text-xs text-gray-500 mt-1">
            (가입 후 무제한 생성 가능!)
          </p>
        </div>
      </div>

      {/* Exit Intent 모달 (닫기 시도 시) */}
      <ExitIntentModal />
    </div>
  );
}
```

---

## 5. 개선사항 우선순위

### MVP (Week 9-10)

```yaml
P0 (필수):
  - ✅ Unsplash API 통합 (5가지 기본 스타일)
  - ✅ 배경 이미지 캐싱 (Redis + Supabase)
  - ✅ Sticky CTA 버튼 (우측 고정)
  - ✅ 결과 페이지 가입 유도 강화

P1 (중요):
  - ⬜ AI 프롬프트 편집 (Pillow 기반 MVP)
  - ⬜ 프롬프트 남용 방지 (일일 10회 제한)
  - ⬜ 플랫폼별 맞춤 크기 (Level 2 기능)

P2 (선택):
  - ⬜ 일괄 다운로드 (Level 1 기능)
  - ⬜ 배경 스타일 즐겨찾기 (Level 3 기능)
```

### Post-MVP (Week 11-12)

```yaml
개선:
  - ⬜ AI 프롬프트 고도화 (DALL-E Variations)
  - ⬜ 일괄 재생성 (Level 4 기능)
  - ⬜ 우선 처리권 (리퍼럴 보상)
  - ⬜ Unsplash 추가 스타일 3종
```

---

**작성일:** 2025-10-23
**버전:** 1.0 (개선)
**다음 검토:** MVP 구현 완료 후
